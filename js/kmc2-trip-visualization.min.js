function drawRoute(e){"use strict";var t,n,r,i,s,o,u,a;e=JSON.parse(e);r={type:"LineString",coordinates:[]};for(t=0;t<e.length;t++)r.coordinates.push([parseFloat(e[t].lon),parseFloat(e[t].lat)]);d3.select(".trip-map svg").remove();vv.svg=d3.select(".trip-map").append("svg");vv.width=jQuery(".trip-map svg").width();vv.height=jQuery(".trip-map svg").height();vv.g=vv.svg.append("g");vv.projection=d3.geo.conicConformal().scale(1);a=d3.geo.path().projection(vv.projection);i=a.bounds(r);s=[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2];s=vv.projection.invert(s);o=vv.width/(i[1][0]-i[0][0]);u=vv.height/(i[1][1]-i[0][1]);vv.projection.scale(Math.min(u,o)*.75).rotate([-s[0],-s[1],0]);vv.projection.translate([vv.width/2,vv.height/2]);a=d3.geo.path().projection(vv.projection);n=vv.g.append("g").attr("class","viaje");n.append("path").datum(r).attr("class","route").attr("d",a);n.selectAll("circle").data(r.coordinates).enter().append("circle").attr("cx",function(e){return vv.projection(e)[0]}).attr("cy",function(e){return vv.projection(e)[1]}).attr("r","5px");d3.json(basepath+"data/countries-110m-topojson.json",function(e){vv.svg.attr("width",vv.width).attr("height",vv.height);vv.aspectratio=vv.width/vv.height;a=d3.geo.path().projection(vv.projection);vv.g.append("path").datum(topojson.mesh(e,e.objects.world,function(e,t){return e!==t})).attr("d",a).attr("class","boundary");vv.g.append("path").datum(topojson.mesh(e,e.objects.world,function(e,t){return e===t})).attr("d",a).attr("class","coast")});n.append("path").datum(d3.geo.graticule()).attr("class","graticule").attr("d",a)}var basepath=kmc2_visualization_vars.basepath,ajaxUrl=kmc2_visualization_vars.siteurl+"wp-admin/admin-ajax.php",category_id=kmc2_visualization_vars.category_id,vv={};jQuery(document).ready(function(){"use strict";vv.mult=1;jQuery.ajax({type:"POST",url:ajaxUrl+"?action=kmc2_trip_places",data:{cat:category_id},success:drawRoute})});jQuery(window).resize(function(){"use strict";vv.mult=jQuery(".trip-map svg").width()/vv.width;vv.svg.attr("width",vv.width*vv.mult).attr("height",vv.height*vv.mult);vv.g.transition().duration(750).attr("transform","scale("+vv.mult+")")});