function onDragging(e){var t=e.target.getLatLng();window.lat=t.lat;window.lon=t.lng;jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lat"]').val(window.lat);jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lon"]').val(window.lon)}function addMarker(){window.marker=L.marker([window.lat,window.lon],{draggable:!0});window.marker.addTo(window.map);window.marker.on("drag",onDragging)}function update_map(){window.lat=jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lat"]').val();window.lon=jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lon"]').val();if(window.lat!==""&&window.lon!==""){addMarker();window.marker.setLatLng([window.lat,window.lon])}}jQuery('#kmc2_maps_post_location_edit input[name="kmc2-visited-places-get"]').click(function(){var e,t,n;n="http://maps.googleapis.com/maps/api/geocode/json?";e="kmc2_maps_place";t=jQuery('input[name="'+e+'"]').val();jQuery.get(n,{address:t,sensor:!1},function(e){if(e.status!=="OK")return!1;window.lat=e.results[0].geometry.location.lat;window.lon=e.results[0].geometry.location.lng;jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lat"]').val(window.lat);jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lon"]').val(window.lon);update_map();return!0})});jQuery(document).ready(function(){var e;window.lat=jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lat"]').val();window.lon=jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lon"]').val();window.map=L.map("map_edit_post_location");e=new L.StamenTileLayer("watercolor");window.map.addLayer(e);if(window.lat!==""&&window.lon!==""){window.map.setView(L.latLng(window.lat,window.lon),14);window.marker=L.marker([window.lat,window.lon],{draggable:!0});window.marker.addTo(window.map);window.marker.on("drag",onDragging)}else{window.map.fitWorld();window.map.on("click",function(e){var t=e.latlng;window.lat=t.lat;window.lon=t.lng;jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lat"]').val(window.lat);jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lon"]').val(window.lon);addMarker();window.map.off("click")})}});jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lat"]').on("change",update_map);jQuery('#kmc2_maps_post_location_edit input[name="kmc2_maps_lon"]').on("change",update_map);